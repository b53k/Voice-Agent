# Architecture

This project is a voice bot that calls an AI phone operator at a medical clinic (Pivot Point Orthopedics) and pretends to be a patient. The goal is to stress-test the clinic's AI operator by throwing tricky scenarios at it, like scheduling, rescheduling, cancellations, refill requests, rapid topic switches, etc; and then analyzing the conversation logs afterwards to find bugs like hallucinations, memory failures, or awkward responses.

The way it works is: `bot.py` uses the Twilio REST API to place an outbound call to the clinic's number, pointing Twilio at a webhook on my FastAPI server (`app.py`). When the call connects, the webhook returns TwiML that starts a ConversationRelay WebSocket connection. I went with ConversationRelay instead of raw Media Streams because it handles all the STT and TTS on Twilio's side. My server just sends and receives plain text over the WebSocket, which kept things way simpler than dealing with audio chunks and Voice Activity Detection (VAD) myself. 

On my end, the WebSocket handler buffers incoming operator messages (with a 6-second silence timeout so I don't respond to half-finished sentences), passes the full message to a Gemini Flash Lite model through LangChain (`conversation.py`), and sends the LLM's reply back as text for Twilio to speak. I also chunk long responses into smaller pieces before sending them because Twilio's TTS would sometimes choke on big blocks of text. Each conversation gets logged to a text file by `conversation_logger.py`, and after all the calls are done, `analyzer.py` feeds those logs into Gemini with a detailed QA prompt to generate per-run analysis summaries and flag bugs. I picked Gemini Flash Lite for both the conversation and analysis because it's fast and cheap enough to run a bunch of test calls without burning through API credits, and the low temperature on the analyzer (0.3) keeps the bug reports more consistent and grounded.

I also manually verified and corrected the analysis summaries in `/analysis` and the `CONSOLIDATED_BUG_REPORT.md` against the actual conversation logs to make sure the findings are accurate.